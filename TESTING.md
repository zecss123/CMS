# CMS振动分析报告系统 - 测试指南

## 🧪 测试概述

本系统提供了完整的测试套件，确保所有功能模块的稳定性和可靠性。测试覆盖了从模板管理到报告生成的完整工作流程。

## 🚀 快速测试

### 运行完整集成测试

```bash
# 进入项目目录
cd cms_vibration_rag

# 运行集成测试
python test_system_integration.py
```

### 预期输出

```
==================================================
测试结果汇总
==================================================

总测试数: 7
通过测试: 7
失败测试: 0
成功率: 100.0%

详细结果:
  template_manager: ✅ 通过
  template_api: ✅ 通过
  knowledge_retriever: ✅ 通过
  chat_manager: ✅ 通过
  chart_generator: ✅ 通过
  report_generator: ✅ 通过
  conclusion_pipeline: ✅ 通过

🎉 所有测试通过！系统功能正常
```

## 📋 测试模块详情

### 1. 模板管理器测试
- **功能**: 模板创建、版本控制、搜索
- **测试内容**:
  - 模板保存和检索
  - 版本历史管理
  - 模板搜索功能
  - 元数据管理

### 2. 模板API测试
- **功能**: Web API接口
- **测试内容**:
  - 模板类型获取
  - 模板列表查询
  - 统计信息获取
  - 默认模板初始化

### 3. 知识检索器测试
- **功能**: 知识库管理
- **测试内容**:
  - 知识库初始化
  - 检索功能验证
  - 索引管理

### 4. 对话管理器测试
- **功能**: LLM结论润色
- **测试内容**:
  - 结论润色处理
  - 上下文管理
  - 响应格式验证

### 5. 图表生成器测试
- **功能**: 振动图表生成
- **测试内容**:
  - 时域波形图生成
  - 频域谱图生成
  - 图文组合功能
  - Base64编码输出

### 6. 报告生成器测试
- **功能**: 多格式报告生成
- **测试内容**:
  - HTML报告生成
  - 模板集成
  - 图表嵌入
  - 格式验证

### 7. 结论管道测试
- **功能**: 端到端处理流程
- **测试内容**:
  - 完整处理管道
  - 图表生成集成
  - 模板检索集成
  - 报告输出验证

## 🔧 单独模块测试

### 模板管理功能测试
```bash
python -m knowledge.template_manager
```

### 图表生成功能测试
```bash
python -m utils.chart_generator
```

### 报告生成功能测试
```bash
python -m report.generator
```

## 📊 测试数据

测试使用模拟的振动分析数据：

### 时域数据
- 采样率: 2048 Hz
- 信号长度: 1000 点
- 信号类型: 正弦波 + 噪声

### 频域数据
- 频率范围: 0-1000 Hz
- 频率分辨率: 500 点
- 幅值分布: 指数衰减

### 分析结果
- RMS值: 2.5-15.0 mm/s
- 主频率: 50-200 Hz
- 报警级别: 正常/注意/警告/危险

## 🐛 故障排除

### 常见测试问题

1. **模块导入失败**
   ```bash
   # 确保在项目根目录运行
   cd cms_vibration_rag
   python test_system_integration.py
   ```

2. **字体警告**
   - 中文字符显示警告是正常的
   - 不影响功能，可以忽略
   - 如需解决，安装中文字体包

3. **临时目录权限**
   ```bash
   # 确保有写入权限
   chmod 755 /tmp
   ```

4. **依赖包缺失**
   ```bash
   # 重新安装依赖
   pip install -r requirements.txt
   ```

### 测试失败处理

如果某个测试失败：

1. **查看错误详情**
   - 测试输出会显示具体错误信息
   - 检查相关模块的日志

2. **检查依赖**
   - 确认所有依赖包已正确安装
   - 检查Python版本兼容性

3. **环境检查**
   - 确认有足够的磁盘空间
   - 检查网络连接（如使用在线模型）

4. **重新运行**
   - 某些测试可能受网络或系统状态影响
   - 可以尝试重新运行测试

## 📈 性能测试

### 基准测试
- 模板创建: < 100ms
- 图表生成: < 2s
- 报告生成: < 5s
- 端到端处理: < 10s

### 内存使用
- 基础运行: ~200MB
- 图表生成: +50MB
- 报告生成: +100MB
- 峰值使用: ~500MB

## 🔄 持续集成

建议在以下情况运行测试：
- 代码修改后
- 依赖更新后
- 部署前验证
- 定期健康检查

## 📝 测试报告

测试完成后，系统会：
- 显示详细的测试结果
- 生成临时测试文件（自动清理）
- 输出性能统计信息
- 提供错误诊断建议

## 📋 相关文档

- **[模板使用指南](TEMPLATE_GUIDE.md)** - 详细的模板上传、格式规范和使用方法
- **[README.md](README.md)** - 系统概述和快速开始指南
- **[扩展计划](EXPANSION_PLAN.md)** - 系统功能扩展规划

---

**注意**: 测试过程中会创建临时文件和目录，测试完成后会自动清理。如果测试中断，可能需要手动清理 `/tmp/cms_test_*` 目录。